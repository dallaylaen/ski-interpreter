"use strict";(()=>{var b=(i,t)=>()=>(t||i((t={exports:{}}).exports,t),t.exports);var Z=b((Se,dt)=>{var O=class{constructor(...t){let e="$|(\\s+)|"+t.map(s=>"(?:"+s+")").sort((s,n)=>n.length-s.length).join("|");this.rex=new RegExp(e,"gys")}split(t){this.rex.lastIndex=0;let e=[...t.matchAll(this.rex)],n=e.pop()?.index??0;if(n!==t.length)throw new Error("Unknown tokens at pos "+n+"/"+t.length+" starting with "+t.substring(n));return e.filter(r=>r[1]===void 0).map(r=>r[0])}},Vt=new O("[-=+]","[A-Z]","\\b[a-z_][a-z_0-9]*\\b");function Bt(i,t){if(!t)return i;let e=new Set([...i]),s={"=":r=>{e=new Set([r]),n="+"},"+":r=>{e.add(r)},"-":r=>{e.delete(r)}},n="=";for(let r of Vt.split(t))s[r]?n=r:s[n](r);return e}var U=class{constructor(t,e){this.value=t,this.decoration=e}};function Qt(i){return i instanceof U?[i.value??void 0,i.decoration]:[i??void 0,void 0]}function Dt(i){let t=e=>new U(e,t);return t.label=i,t.toString=()=>"TraverseControl::"+i,t}dt.exports={Tokenizer:O,restrict:Bt,unwrap:Qt,prepareWrapper:Dt}});var J=b((Ee,gt)=>{"use strict";var{unwrap:x,prepareWrapper:H}=Z(),W={max:1e3,maxArgs:32},Zt={"leftmost-outermost":"LO","leftmost-innermost":"LI",LO:"LO",LI:"LI"},u={descend:H("descend"),prune:H("prune"),redo:H("redo"),stop:H("stop")},w=class i{_setup(t={}){if(t.fancy!==void 0&&(this.fancyName=t.fancyName),t.note!==void 0&&(this.note=t.note),t.arity!==void 0&&(this.arity=t.arity),t.canonize){let e=this.infer(t);e.normal&&(this.arity=this.arity??e.arity,this.note=this.note??e.expr.format({html:!0,lambda:[""," &mapsto; ",""]}),delete e.steps,this.props=e)}return this}apply(...t){let e=this;for(let s of t)e=new k(e,s);return e}expand(){return this.traverse(t=>{if(t instanceof E)return t.impl.expand()})??this}freeOnly(){return!this.any(t=>!(t instanceof g||t instanceof k))}traverse(t,e){typeof t=="function"&&(e=t,t={});let s=Zt[t.order??"LO"];if(s===void 0)throw new Error("Unknown traversal order: "+t.order);let[n,r]=x(this._traverse_redo({order:s},e));return n}_traverse_redo(t,e){let s,n=this,r;do{r=n;let o=t.order==="LI"?n._traverse_descend(t,e)??e(n):e(n)??n._traverse_descend(t,e);[n,s]=x(o)}while(n&&s===u.redo);return!n&&r!==this&&(n=r),s?s(n):n}_traverse_descend(t,e){return null}any(t){return t(this)}fold(t,e){let[s,n]=x(this._fold(t,e));return s??t}_fold(t,e){return e(t,this)}weight(){return 1}infer(t={}){let e=t.max??W.max,s=t.maxArgs??W.maxArgs;return this._infer({max:e,maxArgs:s,index:0})}_infer(t,e=[],s=0){if(e.length>t.maxArgs||s>t.max)return{normal:!1,steps:s};if(this.freeOnly())return{normal:!0,steps:s,...mt(e,this)};let n=this.run({max:(t.max-s)/3});if(s+=n.steps,!n.final)return{normal:!1,steps:s};if(n.steps!==0)return n.expr._infer(t,e,s);if(this.unroll()[0]instanceof g)return{normal:!1,steps:s};let r=wt(e.length+t.index);return this.apply(r)._infer(t,[...e,r],s)}unroll(){return[this]}*toLambda(t={}){let e=this.traverse(r=>{if(r instanceof g||r instanceof k||r instanceof y||r instanceof E)return null;let o=r.infer({max:t.max,maxArgs:t.maxArgs});if(!o.normal)throw new Error("Failed to infer an equivalent  lambda term for "+r);return o.expr})??this,s=new Set,n=0;for(;e;){let r=e.traverse({order:"LI"},o=>{if(s.has(o))return null;if(o instanceof k&&o.fun instanceof y){let a=o.infer({max:t.max,maxArgs:t.maxArgs});return n+=a.steps,a.normal?u.stop(a.expr):(s.add(o),null)}});yield{expr:e,steps:n},e=r}}*toSKI(t={}){let e=this.traverse(n=>n instanceof g||n instanceof k||n instanceof y||n instanceof E?null:n.infer().expr)??this,s=0;for(;e;){let n=e.traverse({order:"LI"},r=>{if(!(r instanceof y)||r.impl instanceof y)return null;if(r.impl===r.arg)return u.stop(T.I);if(!r.impl.any(o=>o===r.arg))return u.stop(T.K.apply(r.impl));if(!(r.impl instanceof k))throw new Error("toSKI: assert failed: lambda body is of unexpected type "+r.impl.constructor.name);return r.impl.arg===r.arg&&!r.impl.fun.any(o=>o===r.arg)?u.stop(r.impl.fun):u.stop(T.S.apply(new y(r.arg,r.impl.fun),new y(r.arg,r.impl.arg)))});yield{expr:e,steps:s,final:!n},s++,e=n}}subst(t,e){return this===t?e:null}invoke(t){return null}step(){return{expr:this,steps:0,changed:!1}}run(t={},...e){t instanceof i&&(e.unshift(t),t={});let s=e?this.apply(...e):this,n=t.steps??0,r=Math.max(t.max??W.max,1)+n,o=!1;for(;n<r;){let a=s.step();if(!a.changed){o=!0;break}n+=a.steps,s=a.expr}if(t.throw&&!o)throw new Error("Failed to compute expression in "+r+" steps");return{final:o,steps:n,expr:s}}*walk(t={}){let e=t.max??1/0,s=0,n=this,r=!1;for(;s<e;){let o=n.step();if(o.changed||(r=!0),yield{expr:n,steps:s,final:r},r)break;s+=o.steps,n=o.expr}}equals(t){return!this.diff(t)}diff(t,e=!1){return this===t?null:t instanceof E?t.impl.diff(this,!e):e?"["+t+" != "+this+"]":"["+this+" != "+t+"]"}expect(t,e=""){if(e=e?e+": ":"",!(t instanceof i))throw new Error(e+"attempt to expect a combinator to equal something else: "+t);let s=this.diff(t);if(!s)return;let n=new Error(e+s);throw n.expected=t+"",n.actual=this+"",n}toString(){return this.format()}_braced(t){return!1}_unspaced(t){return this._braced(!0)}format(t={}){let e=t.html?{brackets:["(",")"],space:" ",var:["<var>","</var>"],lambda:["","-&gt;",""],around:["",""],redex:["",""]}:{brackets:["(",")"],space:" ",var:["",""],lambda:["","->",""],around:["",""],redex:["",""]};return this._format({terse:t.terse??!0,brackets:t.brackets??e.brackets,space:t.space??e.space,var:t.var??e.var,lambda:t.lambda??e.lambda,around:t.around??e.around,redex:t.redex??e.redex,inventory:t.inventory,html:t.html??!1},0)}_format(t,e){throw new Error("No _format() method defined in class "+this.constructor.name)}diag(){let t=(s,n)=>s instanceof k?[n+"App:",...s.unroll().flatMap(r=>t(r,n+"  "))]:s instanceof y?[`${n}Lambda (${s.arg}[${s.arg.id}]):`,...t(s.impl,n+"  ")]:s instanceof E?[`${n}Alias (${s.name}):`,...t(s.impl,n+"  ")]:s instanceof g?[`${n}FreeVar: ${s.name}[${s.id}]`]:[`${n}${s.constructor.name}: ${s}`];return t(this,"").join(`
`)}toJSON(){return this.format()}},k=class i extends w{constructor(t,e){super(),this.arg=e,this.fun=t}weight(){return this.fun.weight()+this.arg.weight()}_infer(t,e=[],s=0){if(e.length>t.maxArgs||s>t.max)return{normal:!1,steps:s};let n=super._infer(t,e,s);if(n.normal)return n;s=n.steps;let[r,...o]=this.unroll();if(!(r instanceof g))return{normal:!1,steps:s};let a=!1,h=!1,c=[];for(let d of o){let p=d._infer({...t,maxArgs:t.maxArgs-e.length,max:t.max-s,index:e.length+t.index});if(s+=p.steps,!p.normal)return{normal:!1,steps:s};c.push(p.expr),a=a||p.discard,h=h||p.duplicate}return{normal:!0,steps:s,...mt(e,r.apply(...c),{discard:a,duplicate:h})}}_traverse_descend(t,e){let[s,n]=x(this.fun._traverse_redo(t,e));if(n===u.stop)return u.stop(s?s.apply(this.arg):null);let[r,o]=x(this.arg._traverse_redo(t,e)),a=s||r?(s??this.fun).apply(r??this.arg):null;return o===u.stop?u.stop(a):a}any(t){return t(this)||this.fun.any(t)||this.arg.any(t)}_fold(t,e){let[s=t,n="descend"]=x(e(t,this));if(n===u.prune)return s;if(n===u.stop)return u.stop(s);let[r=s,o="descend"]=x(this.fun._fold(s,e));if(o===u.stop)return u.stop(r);let[a=r,h="descend"]=x(this.arg._fold(r,e));return h===u.stop?u.stop(a):a}subst(t,e){let s=this.fun.subst(t,e),n=this.arg.subst(t,e);return s||n?(s??this.fun).apply(n??this.arg):null}step(){if(!this.final){let t=this.fun.invoke(this.arg);if(t instanceof w)return{expr:t,steps:1,changed:!0};typeof t=="function"&&(this.invoke=t);let e=this.fun.step();if(e.changed)return{expr:e.expr.apply(this.arg),steps:e.steps,changed:!0};let s=this.arg.step();if(s.changed)return{expr:this.fun.apply(s.expr),steps:s.steps,changed:!0};this.final=!0}return{expr:this,steps:0,changed:!1}}invoke(t){let e=this.fun.invoke(this.arg);return e instanceof w?e.apply(t):typeof e=="function"?(this.invoke=e,e(t)):(this.invoke=s=>null,null)}unroll(){return[...this.fun.unroll(),this.arg]}diff(t,e=!1){if(!(t instanceof i))return super.diff(t,e);let s=this.fun.diff(t.fun,e);if(s)return s+"(...)";let n=this.arg.diff(t.arg,e);return n?this.fun+"("+n+")":null}_braced(t){return!t}_format(t,e){let s=this.fun._format(t,e+1),n=this.arg._format(t,0),r=e?["",""]:t.around;return t.terse&&!this.arg._braced(!1)?r[0]+s+(this.fun._unspaced(this.arg)?"":t.space)+n+r[1]:r[0]+s+t.brackets[0]+n+t.brackets[1]+r[1]}_unspaced(t){return this.arg._braced(!1)?!0:this.arg._unspaced(t)}},A=class i extends w{constructor(t){if(super(),typeof t!="string"||t.length===0)throw new Error("Attempt to create a named term with improper name");this.name=t}_unspaced(t){return!!(t instanceof i&&(this.name.match(/^[A-Z+]$/)&&t.name.match(/^[a-z+]/i)||this.name.match(/^[a-z+]/i)&&t.name.match(/^[A-Z+]$/)))}_format(t,e){let s=t.html?this.fancyName??this.name:this.name;return this.arity>0&&this.arity<=e?t.redex[0]+s+t.redex[1]:s}},Wt=0,g=class i extends A{constructor(t,e){super(t),this.id=++Wt,this.scope=e===void 0?this:e}weight(){return 0}diff(t,e=!1){if(!(t instanceof i))return super.diff(t,e);if(this.name===t.name&&this.scope===t.scope)return null;let s=this.name+"["+this.id+"]",n=t.name+"["+t.id+"]";return e?"["+n+" != "+s+"]":"["+s+" != "+n+"]"}subst(t,e){return t instanceof i&&t.name===this.name&&t.scope===this.scope?e:null}_format(t,e){let s=t.html?this.fancyName??this.name:this.name;return t.var[0]+s+t.var[1]}};g.global=["global"];var K=class extends A{constructor(t,e,s={}){super(t),this.invoke=e,this._setup({canonize:!0,...s})}},T={};function L(i,t,e){T[i]=new K(i,t,e)}var y=class i extends w{constructor(t,e){if(Array.isArray(t)){if(t.length===0)throw new Error("empty argument list in lambda constructor");let[n,...r]=t,o=new Set([n.name]);for(;r.length>0;){let a=r.pop();if(o.has(a.name))throw new Error("Duplicate free var name "+a+" in lambda expression");o.add(a.name),e=new i(a,e)}t=n}super();let s=new g(t.name,this);this.arg=s,this.impl=e.subst(t,s)??e,this.arity=1}weight(){return this.impl.weight()+1}_infer(t,e=[],s=0){if(e.length>t.maxArgs)return{normal:!1,steps:s};let n=wt(e.length+t.index);return this.invoke(n)._infer(t,[...e,n],s+1)}invoke(t){return this.impl.subst(this.arg,t)??this.impl}_traverse_descend(t,e){let[s,n]=x(this.impl._traverse_redo(t,e)),r=s?new i(this.arg,s):null;return n===u.stop?u.stop(r):r}any(t){return t(this)||this.impl.any(t)}_fold(t,e){let[s=t,n="descend"]=x(e(t,this));if(n===u.prune)return s;if(n===u.stop)return u.stop(s);let[r,o]=x(this.impl._fold(s,e));return o===u.stop?u.stop(r):r??s}subst(t,e){if(t===this.arg)return null;let s=this.impl.subst(t,e);return s?new i(this.arg,s):null}diff(t,e=!1){if(!(t instanceof i))return super.diff(t,e);let s=new g("t"),n=this.invoke(s).diff(t.invoke(s),e);return n?"(t->"+n+")":null}_format(t,e){return(e>0?t.brackets[0]:"")+t.lambda[0]+this.arg._format(t,0)+t.lambda[1]+this.impl._format(t,0)+t.lambda[2]+(e>0?t.brackets[1]:"")}_braced(t){return!0}},j=class i extends w{constructor(t){if(t=Number.parseInt(t),!(t>=0))throw new Error("Church number must be a non-negative integer");super(),this.invoke=e=>s=>{let n=s;for(let r=t;r-- >0;)n=e.apply(n);return n},this.n=t,this.arity=2}diff(t,e=!1){return t instanceof i?this.n===t.n?null:e?"["+t.n+" != "+this.n+"]":"["+this.n+" != "+t.n+"]":super.diff(t,e)}_rski(t){return this.infer().expr._rski(t)}_unspaced(t){return!1}_format(t,e){return e>=2?t.redex[0]+this.n+t.redex[1]:this.n+""}};function pt(i,t){return e=>t<=1?i.apply(e):pt(i.apply(e),t-1)}var E=class extends A{constructor(t,e,s={}){if(super(t),!(e instanceof w))throw new Error("Attempt to create an alias for a non-expression: "+e);this.impl=e,this._setup(s),this.terminal=s.terminal??this.props?.proper,this.invoke=pt(e,this.arity??0)}weight(){return this.terminal?1:this.impl.weight()}_traverse_descend(t,e){return this.impl._traverse_redo(t,e)}any(t){return t(this)||this.impl.any(t)}_fold(t,e){let[s=t,n]=x(e(t,this));if(n===u.prune)return s;if(n===u.stop)return u.stop(s);let[r,o]=x(this.impl._fold(s,e));return o===u.stop?u.stop(r):r??s}subst(t,e){return this===t?e:this.impl.subst(t,e)}_infer(t,e=[],s=0){return this.impl._infer(t,e,s)}step(){return this.arity>0?{expr:this,steps:0,changed:!1}:{expr:this.impl,steps:0,changed:!0}}diff(t,e=!1){return this===t?null:t.diff(this.impl,!e)}_rski(t){return this.impl._rski(t)}_braced(t){return this.outdated?this.impl._braced(t):!1}_format(t,e){return(t.inventory?t.inventory[this.name]!==this:this.outdated)?this.impl._format(t,e):super._format(t,e)}};L("I",i=>i);L("K",i=>t=>i);L("S",i=>t=>e=>i.apply(e,t.apply(e)));L("B",i=>t=>e=>i.apply(t.apply(e)));L("C",i=>t=>e=>i.apply(e).apply(t));L("W",i=>t=>i.apply(t).apply(t));L("+",i=>i instanceof j?new j(i.n+1):t=>e=>t.apply(i.apply(t,e)),{note:"Increase a Church numeral argument by 1, otherwise n => f => x => f(n f x)"});function mt(i,t,e={}){let s=new Array(i.length).fill(0),n=!0;t.traverse(a=>{if(a instanceof g){let h=i.findIndex(c=>c.name===a.name);if(h>=0){s[h]++;return}}a instanceof k||(n=!1)});let r=new Set,o=new Set;for(let a=0;a<i.length;a++)s[a]===0?r.add(a):s[a]>1&&o.add(a);return{expr:i.length?new y(i,t):t,...e.synth?{}:{arity:i.length},...r.size?{skip:r}:{},...o.size?{dup:o}:{},duplicate:!!o.size||e.duplicate||!1,discard:!!r.size||e.discard||!1,proper:n}}function wt(i){return new g("abcdefgh"[i]??"x"+i)}function Jt(i,t){if(i instanceof w&&(i=[i]),t)i||(i=Object.keys(t).sort().map(r=>t[r]));else{if(!i)return[];if(!t){t={};for(let r of i)if(r instanceof A){if(t[r.name])throw new Error("duplicate name "+r);t[r.name]=r}}}let e=[],s=new Set,n=r=>{s.has(r)||(r.fold(null,(o,a)=>{if(a!==r&&a instanceof A&&t[a.name]===a)return n(a),w.control.prune(null)}),e.push(r),s.add(r))};for(let r of i)n(r);return{list:e,env:t}}w.native=T;w.control=u;w.extras={toposort:Jt};gt.exports={Expr:w,App:k,Named:A,FreeVar:g,Lambda:y,Native:K,Alias:E,Church:j}});var X=b((qe,bt)=>{"use strict";var{Tokenizer:Yt,restrict:Y}=Z(),xt=J(),{Expr:C,Named:Ae,Native:Gt,Alias:_,FreeVar:I,Lambda:Xt,Church:yt}=xt,{native:M}=C,$=class extends C{apply(...t){return t.length?t.shift().apply(...t):this}postParse(){throw new Error("Attempt to use empty expression () as a term")}},G=class i extends ${constructor(t,e={}){if(super(),this.impl=new $,t instanceof I)this.terms=[t];else if(t instanceof i){if(!(t.impl instanceof I))throw new Error("Expected FreeVar->...->FreeVar->Expr");this.terms=[...t.terms,t.impl]}else throw new Error("Expected FreeVar or PartialLambda")}apply(t,...e){if(t===null||e.length!==0)throw new Error("bad syntax in partial lambda expr");return this.impl=this.impl.apply(t),this}postParse(){return new Xt(this.terms,this.impl)}};function vt(i){return i.postParse?i.postParse():i}var te=new Yt("[()]","[A-Z]","[a-z_][a-z_0-9]*","\\b[0-9]+\\b","->","\\+"),S=class{constructor(t={}){if(this.annotate=t.annotate??!1,this.known={...M},this.hasNumbers=!0,this.hasLambdas=!0,this.allow=new Set(Object.keys(this.known)),Array.isArray(t.terms))this.bulkAdd(t.terms);else if(t.terms)for(let e in t.terms)t.terms[e].match(/^Native:/)||this.add(e,t.terms[e]);this.hasNumbers=t.numbers??!0,this.hasLambdas=t.lambdas??!0,t.allow&&this.restrict(t.allow)}add(t,e,s){return t=this._named(t,e),typeof s=="string"&&(s={note:s,canonize:!1}),t._setup({canonize:this.annotate,...s}),this.known[t.name]&&(this.known[t.name].outdated=!0),this.known[t.name]=t,this.allow.add(t.name),this}_named(t,e){if(t instanceof _)return new _(t.name,t.impl,{canonize:!0});if(typeof t!="string")throw new Error("add(): term must be an Alias or a string");if(e===void 0)throw new Error("add(): impl must be provided when term is a string");if(typeof e=="string")return new _(t,this.parse(e),{canonize:!0});if(e instanceof C)return new _(t,e,{canonize:!0});if(typeof e=="function")return new Gt(t,e);throw new Error("add(): impl must be an Expr, a string, or a function with a signature Expr => ... => Expr")}maybeAdd(t,e){return this.known[t]?this.allow.add(t):this.add(t,e),this}bulkAdd(t){for(let e of t){let s=e.match(/^([A-Z]|[a-z][a-z_0-9]*)\s*=\s*(.*)$/s);if(!s)throw new Error("bulkAdd: invalid declaration: "+e);s[2]===""?this.remove(s[1]):this.add(s[1],this.parse(s[2]))}return this}restrict(t){return this.allow=Y(this.allow,t),this}showRestrict(t="+"){let e=[],s=!0;for(let n of[...Y(this.allow,t)].sort()){let r=n.match(/^[A-Z]$/);e.length&&!(s&&r)&&e.push(" "),e.push(n),s=r}return e.join("")}remove(t){return this.known[t].outdated=!0,delete this.known[t],this.allow.delete(t),this}getTerms(){let t={};for(let e of Object.keys(this.known))this.allow.has(e)&&(t[e]=this.known[e]);return t}declare(){let t=this.getTerms();for(let a in t)t[a]instanceof _||delete t[a];let e={},s=1;for(let a in M){if(!(t[a]instanceof _))continue;for(;"tmp"+s in t;)s++;let h=new _("tmp"+s,t[a]);e[h]=t[a],t[h]=h,delete t[a]}let n=C.extras.toposort(void 0,t).list,r=new Map;if(Object.keys(e).length){let a=h=>h.traverse(c=>{if(!(c instanceof _))return null;let d=r.get(c);return d||new _(c.name,a(c.impl))})??h;for(let h=0;h<n.length;h++)n[h]=a(n[h],r),r.set(e[n[h].name],n[h]),t[n[h].name]=n[h],console.log(`list[${h}] = ${n[h].name}=${n[h].impl};`);console.log("detour:",r)}let o=n.map(a=>e[a]?a.name+"="+e[a].name+"="+a.impl.format({inventory:t}):a.name+"="+a.impl.format({inventory:t}));for(let[a,h]of r)o.push(a+"="+h,h+"=");return o}parse(t,e={}){if(typeof t!="string")throw new Error("parse: source must be a string, got "+typeof t);let s=t.replace(/\/\/[^\n]*$/gm," ").replace(/\/\*.*?\*\//gs," ").trim().split(/\s*;[\s;]*/).filter(o=>o.match(/\S/)),n={...e.env},r=new $;for(let o of s){r instanceof _&&(r.outdated=!0);let a=o.match(/^([A-Z]|[a-z][a-z_0-9]*)\s*=(.*)$/s);if(a&&a[2]===""?r=new I(a[1],e.scope??I.global):r=this.parseLine(o,n,e),a){if(n[a[1]]!==void 0)throw new Error("Attempt to redefine a known term: "+a[1]);n[a[1]]=r}}return r.context={env:{...this.getTerms(),...n},scope:e.scope,src:t,parser:this},r}parseLine(t,e={},s={}){let n=t.match(/^\s*([A-Z]|[a-z][a-z_0-9]*)\s*=\s*(.*)$/s);if(n)return new _(n[1],this.parseLine(n[2],e,s));let r={numbers:s.numbers??this.hasNumbers,lambdas:s.lambdas??this.hasLambdas,allow:Y(this.allow,s.allow)};r.numbers?r.allow.add("+"):r.allow.delete("+");let o=te.split(t),a=new $,h=[a],c=s.scope||I.global;for(let d of o)if(d==="(")h.push(a);else if(d===")"){if(h.length<2)throw new Error("unbalanced input: extra closing parenthesis"+t);let p=vt(h.pop()),m=h.pop();h.push(m.apply(p))}else if(d==="->"){if(!r.lambdas)throw new Error("Lambdas not supported, allow them explicitly");h.push(new G(h.pop(),e))}else if(d.match(/^[0-9]+$/)){if(!r.numbers)throw new Error("Church numbers not supported, allow them explicitly");let p=h.pop();h.push(p.apply(new yt(d)))}else{let p=h.pop();if(!e[d]&&this.known[d]&&!r.allow.has(d))throw new Error("Term '"+d+"' is not in the restricted set "+[...r.allow].sort().join(" "));let m=e[d]??this.known[d]??(e[d]=new I(d,c));h.push(p.apply(m))}if(h.length!==1)throw new Error("unbalanced input: missing "+(h.length-1)+" closing parenthesis:"+t);return vt(h.pop())}toJSON(){return{version:"1.1.1",allow:this.showRestrict("+"),numbers:this.hasNumbers,lambdas:this.hasLambdas,annotate:this.annotate,terms:this.declare()}}};S.vars=function(i={}){let t={};return new Proxy({},{get:(e,s)=>(s in t||(t[s]=new I(s,i)),t[s])})};S.church=i=>new yt(i);for(let i in M)S[i]=M[i];S.classes=xt;S.native=M;S.control=C.control;bt.exports={SKI:S}});var rt=b((ze,Et)=>{var{SKI:q}=X(),{Expr:Le,FreeVar:ee,Alias:kt,Lambda:Ie}=q.classes,z=class{constructor(t){let{input:e,cases:s,allow:n,numbers:r,lambdas:o,engine:a,engineFull:h,...c}=t,d=t.env??t.vars;this.engine=a??new q,this.engineFull=h??new q,this.restrict={allow:n,numbers:r??!1,lambdas:o??!1},this.env={};let p={};for(let m of d??[]){let f=this.engineFull.parse(m,{env:p,scope:this});if(f instanceof q.classes.Alias)this.env[f.name]=new kt(f.name,f.impl,{terminal:!0,canonize:!1});else if(f instanceof q.classes.FreeVar)this.env[f.name]=f;else throw new Error("Unsupported given variable type: "+m)}this.input=[];for(let m of Array.isArray(e)?e:[e])this.addInput(m);if(!this.input.length)throw new Error("Quest needs at least one input placeholder");this.envFull={...this.env,...p};for(let m of this.input){if(m.name in this.envFull)throw new Error("input placeholder name is duplicated or clashes with env: "+m.name);this.envFull[m.name]=m.placeholder}this.cases=[],this.name=c.name??c.title,c.intro=_t(c.intro??c.descr),this.intro=c.intro,this.id=c.id,this.meta=c;for(let m of s??[])this.add(...m)}allowed(){let t=this.restrict.allow??"",e=Object.keys(this.env).sort();return t?this.engine.showRestrict(t+"+"+e.join(" ")):e.map(s=>"+"+s).join(" ")}addInput(t){if(typeof t!="object"&&(t={name:t}),typeof t.name!="string")throw new Error("quest 'input' field must be a string or a {name: string, ...} object");t.placeholder=new q.classes.FreeVar(t.name),this.input.push(t)}add(t,...e){typeof t=="string"?(e.unshift(t),t={}):t={...t},t.engine=t.engine??this.engineFull,t.env=t.env??this.envFull;let s=this.input.map(n=>n.placeholder);return this.cases.push(t.caps?new et(s,t,e):new tt(s,t,e)),this}prepare(...t){if(t.length!==this.input.length)throw new Error("Solutions provided "+t.length+" terms where "+this.input.length+" are expected");let e=0,s=[],n={...this.env};for(let r=0;r<t.length;r++){let o=this.input[r],a=this.engine.parse(t[r],{env:n,allow:o.allow??this.restrict.allow,numbers:o.numbers??this.restrict.numbers,lambdas:o.lambdas??this.restrict.lambdas}),h={...this.engine.getTerms(),...n};e+=a.fold(0,(d,p)=>{if(p instanceof q.classes.Named&&h[p.name]===p)return q.control.prune(d+1)});let c=a instanceof ee?a:new kt(o.fancy??o.name,a,{terminal:!0,canonize:!1});n[o.name]=c,s.push(c)}return{prepared:s,weight:e}}check(...t){try{let{prepared:e,weight:s}=this.prepare(...t),n=this.cases.map(a=>a.check(...e)),r=n.reduce((a,h)=>a&&h.pass,!0),o=n.reduce((a,h)=>a+h.steps,0);return{expr:e[0],input:e,pass:r,steps:o,details:n,weight:s}}catch(e){return{pass:!1,details:[],exception:e,steps:0,input:t}}}verify(t){let e=this.verifyMeta(t);if(t.solutions){let s=this.verifySolutions(t.solutions);s&&(e.solutions=s)}return t.seen&&(this.id||(e.seen="No id in quest "+(this.name??"(unnamed)")),t.seen.has(this.id)&&(e.seen="Duplicate quest id "+this.id),t.seen.add(this.id)),Object.keys(e).length?e:null}verifySolutions(t){if(typeof t=="object"&&!Array.isArray(t?.accepted)&&!Array.isArray(t?.rejected)&&(!this.id||!t[this.id]))return null;let{accepted:e=[],rejected:s=[]}=t[this.id]??t,n={shouldPass:[],shouldFail:[]};for(let r of e){let o=this.check(...r);o.pass||n.shouldPass.push({input:r,result:o})}for(let r of s){let o=this.check(...r);o.pass&&n.shouldFail.push({input:r,result:o})}return n.shouldFail.length+n.shouldPass.length?n:null}verifyMeta(t={}){let e={};for(let s of["name","intro"]){let n=St(this[s]);n&&(e[s]=n)}if(t.date){let s=new Date(this.meta.created_at);isNaN(s)?e.date="invalid date format: "+this.meta.created_at:(s<new Date("2024-07-15")||s>new Date)&&(e.date="date out of range: "+this.meta.created_at)}return e}show(){return[...this.cases]}},N=class{constructor(t,e){this.max=e.max??1e3,this.note=e.note,this.env={...e.env??{}},this.input=t,this.engine=e.engine}parse(t){return new st(this.engine.parse(t,{env:this.env,scope:this}),this.input)}check(...t){throw new Error("not implemented")}},tt=class extends N{constructor(t,e,s){if(s.length!==2)throw new Error("Case accepts exactly 2 strings");super(t,e),[this.e1,this.e2]=s.map(n=>this.parse(n))}check(...t){let e=this.e1.apply(t),s=e.run({max:this.max}),r=this.e2.apply(t).run({max:this.max}),o=null;return!s.final||!r.final?o="failed to reach normal form in "+this.max+" steps":o=s.expr.diff(r.expr),{pass:!o,reason:o,steps:s.steps,start:e,found:s.expr,expected:r.expr,note:this.note,args:t,case:this}}},se={normal:!0,proper:!0,discard:!0,duplicate:!0,linear:!0,affine:!0,arity:!0},et=class extends N{constructor(t,e,s){if(super(t,e),s.length>1)throw new Error("PropertyCase accepts exactly 1 string");if(!e.caps||typeof e.caps!="object"||!Object.keys(e.caps).length)throw new Error("PropertyCase requires a caps object with at least one capability");let n=Object.keys(e.caps).filter(r=>!se[r]);if(n.length)throw new Error("PropertyCase: don't know how to test these capabilities: "+n.join(", "));this.expr=this.parse(s[0]),this.caps=e.caps,this.caps.linear&&(delete this.caps.linear,this.caps.duplicate=!1,this.caps.discard=!1,this.caps.normal=!0),this.caps.affine&&(delete this.caps.affine,this.caps.normal=!0,this.caps.duplicate=!1)}check(...t){let e=this.expr.apply(t),s=e.run({max:this.max}),n=s.expr.infer({max:this.max}),r=[];for(let o in this.caps)n[o]!==this.caps[o]&&r.push("expected property "+o+" to be "+this.caps[o]+", found "+n[o]);return{pass:!r.length,reason:r?r.join(`
`):null,steps:s.steps,start:e,found:s.expr,case:this,note:this.note,args:t}}},st=class{constructor(t,e){this.expr=t,this.env=e}apply(t){if(t.length!==this.env.length)throw new Error("Subst: expected "+this.env.length+" terms, got "+t.length);let e=this.expr;for(let s=0;s<this.env.length;s++)e=e.subst(this.env[s],t[s])??e;return e}},nt=class{constructor(t){this.name=t.name,this.intro=_t(t.intro),this.id=t.id,t.content&&(this.content=t.content.map(e=>e instanceof z?e:new z(e)))}verify(t){let e={},s=ne(this.id,t.seen);s&&(e[this.id]=s);for(let n of["name","intro"]){let r=St(this[n]);r&&(e[n]=r)}return e.content=this.content.map(n=>n.verify(t)),e}};function _t(i){return i===void 0||typeof i=="string"?i:Array.isArray(i)?i.join(" "):""+i}function ne(i,t){if(i===void 0)return"missing";if(typeof i!="string"&&typeof i!="number")return"is a "+typeof i;if(t){if(t.has(i))return"duplicate id "+i;t.add(i)}}function St(i){if(i===void 0)return"missing";if(typeof i!="string")return"not a string but "+typeof i;let t=[],e=/<\/?([a-z]+)(?:\s[^>]*)?>/gi,s;for(;(s=e.exec(i))!==null;){let[n,r]=s;if(n.startsWith("</")){if(t.length===0||t.pop()!==r)return`Unmatched closing tag: </${r}>`}else t.push(r)}return t.length>0?`Unclosed tags: ${t.join(", ")}`:null}z.Group=nt;z.Case=N;Et.exports={Quest:z}});var It=b(($e,Lt)=>{"use strict";var{Expr:qt,Alias:re,FreeVar:ie}=J(),{Quest:At}=rt();function ae(i,t,e){let{depth:s=16,infer:n=!0,progressInterval:r=1e3}=t,o=n&&!t.noskip,a=[[]],h=0,c=0,d={},p=f=>{h++;let v=n?f.infer({max:t.max,maxArgs:t.maxArgs}):null;if(o&&v.expr){if(d[v.expr])return{res:-1};d[v.expr]=!0}return c++,{res:e(f,v),props:v}};for(let f of i){let{res:v}=p(f);if(v>0)return{expr:f,total:h,probed:c,gen:1};if(v<0)continue;a[0].push(f)}let m;for(let f=1;f<s;f++){t.progress&&(t.progress({gen:f,total:h,probed:c,step:!0}),m=h);for(let v=0;v<f;v++)for(let ut of a[f-v-1]||[])for(let Rt of a[v]||[]){if(h>=t.tries)return{total:h,probed:c,gen:f,...t.retain?{cache:a}:{}};t.progress&&h-m>=r&&(t.progress({gen:f,total:h,probed:c,step:!1}),m=h);let B=ut.apply(Rt),{res:ft,props:Q}=p(B);if(ft>0)return{expr:B,total:h,probed:c,gen:f,...t.retain?{cache:a}:{}};if(ft<0)continue;let D=n?(Q.expr?0:3)+(Q.dup?1:0)+(Q.proper?0:1):0;a[f+D]||(a[f+D]=[]),a[f+D].push(B)}}return{total:h,probed:c,gen:s,...t.retain?{cache:a}:{}}}function it(i,t={}){if(i instanceof qt)return i.format(t);if(i instanceof At)return"Quest("+i.name+")";if(i instanceof At.Case)return"Quest.Case";if(Array.isArray(i))return i.map(it);if(typeof i!="object"||i===null||i.constructor!==Object)return i;let e={};for(let s in i)e[s]=it(i[s]);return e}function oe(i,t){let e=qt.extras.toposort([i],t);return e.list.map(s=>s instanceof re?s.name+"="+s.impl.format({inventory:e.env}):s instanceof ie?s.name+"=":s.format({inventory:e.env})).join("; ")}Lt.exports={search:ae,deepFormat:it,declare:oe}});var Ft=b((Fe,$t)=>{var{SKI:F}=X(),{Quest:zt}=rt(),he=It();F.Quest=zt;F.extras={...he,...F.classes.Expr.extras};typeof process=="object"&&process.env.SKI_REPL&&typeof global<"u"&&(global.SKI=F,console.log("SKI_REPL activated, try `new SKI();`"));typeof window<"u"&&(window.SKI=F);$t.exports={SKI:F,Quest:zt}});var jt=b((Te,Tt)=>{var at=class{constructor(t){this.ns=t+":"}save(t,e){window.localStorage.setItem(this.ns+t,JSON.stringify(e))}load(t){return JSON.parse(window.localStorage.getItem(this.ns+t))}scan(){let t=window.localStorage,e=[];for(let s=0;s<t.length;s++){let n=t.key(s);n.startsWith(this.ns)&&e.push(n.substring(this.ns.length))}return e}delete(t){window.localStorage.removeItem(this.ns+t)}};Tt.exports={Store:at}});var ot=b((je,Mt)=>{"use strict";function le(...i){let t={};for(let e of i){let s=e.replace(/[A-Z]/g,n=>"-"+n.toLowerCase());if(t[e]=document.getElementById(s),!t[e])throw new Error(`View element not found: ${s}`)}return t}function ce(i,t,e={},s=null){let n=document.createElement(t);return e.class&&n.classList.add(...e.class),e.content!==void 0&&(n.innerHTML=""+e.content),e.hidden&&(n.hidden=!0),e.color&&(n.style.color=e.color),i&&i.appendChild(n),s&&s(n),n}function Ct(i,t){t(i);for(let e of i.childNodes)Ct(e,t)}function ue(i){typeof i!="string"&&(i=""+i);let t={"<":"&lt;",">":"&gt;","&":"&amp;"};return i.replace(/[<>&]/g,e=>t[e])}function fe(i){let t={"(":"%28",")":"%29"};return encodeURIComponent(i).replace(/[()]/g,e=>t[e]).replace(/%20/g,"+")}function de(i){return decodeURIComponent((""+i).replace(/\+/g," "))}Mt.exports={append:ce,decode:de,encode:fe,grabView:le,sanitize:ue,traverse:Ct}});var Pt=b((Ce,Nt)=>{"use strict";var{append:ht}=ot(),lt=class{constructor(t={}){this.options=t,this.height=t.height??5,this.running=!1,this.delay=t.delay??0,this.maxSteps=t.max??1/0,this.onStart=t.onStart??(()=>{}),this.onStop=t.onStop??(()=>{}),this.onStep=t.onStep??(()=>{}),this.engine=t.engine,this.format=t.format??{html:!0},this.generator=t.generator??(e=>e.walk()),this.set(t.expr),this.view={},this.view.parent=t.parent,this.view.scroll=t.scroll??t.parent,this.view.main=ht(t.parent,"ol",{class:["ski-eval-box"]})}set(t){if(typeof t=="string")this.src=t,this.expr=this.engine.parse(t);else if(Array.isArray(t)&&t.length===2)this.src=t[0],this.expr=t[1];else if(!t)this.expr=null,this.src=null;else if(typeof t=="object"&&typeof t.format=="function")this.expr=t,this.src=t.format();else throw new Error("EvalBox.set() expects a string, Expr, or [string, Expr]");return this}start(t){this.running&&this.stop();try{t!==void 0&&this.set(t),this.seq=this.generator(this.expr)}catch(e){return console.error(e),this.stop(e.message)}return this.view.main.innerHTML="",this.onStart(),this.running=!0,this.tick(),this}stop(t){this.running=!1,this.timer&&(clearTimeout(this.timer),this.timer=null),t&&this.print(t,{class:["ski-eval-error"],line:""}),this.onStop()}resume(){this.running||!this.seq||(this.running=!0,this.onStart(),this.tick())}tick(){if(!this.running)return;let{value:t,done:e}=this.seq.next();if(t&&this.print(t.expr.format(this.format),{line:t.steps}),this.onStep(t,e||t.final),e||t.final)return this.view.last&&this.view.last.classList.add("ski-eval-success"),this.seq=null,this.stop();if(t.steps>=this.maxSteps)return this.stop("Max steps reached: "+this.maxSteps);this.timer=setTimeout(()=>this.tick(),this.delay)}remove(){this.view.parent&&(this.view.parent.removeChild(this.view.main),this.view.parent=null)}clear(){this.stop(),this.view.main.innerHTML=""}setHeight(t){this.height=t}print(t,e={}){let s=ht(this.view.main,"li",e);if(e.line!==0&&!e.line?s.style["list-style"]="none":(this.view.main.style["padding-left"]=(""+e.line).length+2.5+"ch",s.value=e.line),this.view.last=s,e.raw)s.innerHTML=t;else for(ht(s,"span",{class:e.class??["ski-eval-line"],color:e.color,content:t});this.view.main.children.length>this.height;)this.view.main.removeChild(this.view.main.firstChild);return this.view.scroll&&(this.view.scroll.scrollTop=s.offsetTop),s}};Nt.exports={EvalBox:lt}});var Kt=b((Me,Ht)=>{"use strict";var{SKI:P}=Ft(),{Store:pe}=jt(),{EvalBox:me}=Pt(),{append:l}=ot(),ct=class{constructor(t){if(this.view={},this.root=t.baseUrl??".",!t.store&&!t.storePrefix)throw new Error("No storePrefix provided");this.store=t.store??new pe(t.storePrefix),this.engine=t.engine??new P(this.store.load("engine")??{annotate:!0,allow:"SKI"}),t.inventoryBox&&(this.view.inventory=t.inventoryBox,this.showKnown()),this.view.content=t.contentBox,t.indexBox&&(this.view.index=l(t.indexBox,"div",{class:["ski-quest-nav"]})),this._onSolved=t.onSolved,this._onFailed=t.onFailed,this._onUnlock=t.onUnlock,this.chapters=[]}loadFromIndex(t,e,s){fetch(this.mkLink(t)).then(n=>n.json()).then(n=>this.loadChapters(n)).then(n=>{if(s&&s(n),e){let r=document.getElementById(e);r&&r.scrollIntoView()}})}async loadChapters(t){let e=0;this.chapters=[];let s=[];for(let n of t){let r=new V({number:++e,link:this.mkLink(n),engine:this.engine,store:this.store,onUnlock:o=>this.onUnlock(o),onSolved:o=>this._onSolved(o),onFailed:o=>this._onFailed(o)});this.chapters.push(r),r.attach(this.view.content,{placeholder:"loading chapter"+r.number+"..."}),this.view.index&&r.addLink(this.view.index),s.push(r.fetch().then(o=>{o.draw()}))}return Promise.all(s).then(()=>this)}mkLink(t){return t.match(/^\w+:\/\//)||t.match(/^[/.]/)?t:this.root+"/"+t}onUnlock(t){this.engine.maybeAdd(t.name,t.impl),this.store&&this.store.save("engine",this.engine),this.showKnown(),this._onUnlock&&this._onUnlock(t)}showKnown(){if(!this.view.inventory)return;this.view.inventory.innerHTML="";let t=l(this.view.inventory,"ul",{class:["ski-quest-inventory"]}),e=this.engine.getTerms();for(let s of Object.keys(e).sort().map(n=>[n,e[n]])){let n=l(t,"li",{},r=>{r.dataset.skiTerm=s[0]});l(n,"span",{content:s[0],class:["ski-quest-term-name"]}),l(n,"span",{content:": "}),l(n,"span",{content:ve(s[1]),class:["ski-quest-term-def"]})}}demolish(){for(let t of this.store.scan())this.store.delete(t)}},R=class{constructor(t,e){let s=e.engine??e.chapter?.engine;if(!s)throw new Error("QuestBox requires an engine: SKI in either options or chapter");let n=e.store??e.chapter?.store;if(!n)throw new Error("QuestBox requires a store: Store in either options or chapter");this.impl=new P.Quest({...t,engine:s}),this.name=this.impl.id?"quest-"+this.impl.id:"",this.chapter=e.chapter,this.chapter&&e.number&&(this.number=this.chapter.number+"."+e.number),this.store=n,this.engine=s,this.view={},this.input=[]}load(){let t=this.store.load(this.name)??{};return this.status={solved:t.solved??!1,steps:t.steps??0,attempts:t.attempts??0,weight:t.weight??0,total:t.total??0},this.status.solved&&this.onSolved(),this}save(){return this.store.save(this.name,this.status),this}update(t){this.status.solved||(this.status.attempts++,this.status.total+=t.steps,this.status.steps=t.steps,this.status.weight=t.weight,t.pass&&(this.status.solved=!0,this.onSolved(t)),this.save(),this.showStatus())}onSolved(t){if(this.impl.meta.unlock&&t){let e=new P.classes.Alias(this.impl.meta.unlock,t.expr.expand());this.chapter?.onUnlock(e)}this.chapter&&this.chapter.addSolved(this.impl.id)}check(){this.view.display&&(this.view.display.innerHTML="running...");let t=this.input.map(s=>s.value),e=this.impl.check(...t);this.showResult(e),this.update(e)}draw(t){this.view.frame=l(t,"div",{class:["ski-quest-box"]}),this.view.frame.id=this.name;let e=l(this.view.frame,"h3"),s=l(this.view.frame,"div"),n=l(e,"a",{content:this.number?"#"+this.number:"Quest"});n.href="#"+this.name,n.onclick=()=>Ut(s,!0),l(e,"span",{content:" "+this.impl.name});let r=this.impl.allowed();r&&l(e,"span",{content:" ["+r+"]"}),this.view.stat=l(e,"span",{class:["ski-quest-float-right"]});let o=l(s,"div");l(o,"div",{content:Ot(this.impl.intro),class:["ski-quest-intro"]}),this.impl.meta.hint&&we(o," Hint:..."," Hint: "+this.impl.meta.hint),this.view.display=l(s,"div",{class:["ski-quest-display"],content:"....."}),this.view.solution=l(s,"div",{class:["ski-quest-input"]}),this.drawInput(this.view.solution),this.showStatus()}drawInput(t){let e=this.impl.input,s=e.length!==1;for(let r of e){if(s){let a=l(t,"div",{class:["ski-quest-label"]});l(a,"b",{content:r.name}),r.note&&l(a,"span",{content:" // "+r.note,class:["ski-quest-comment"]})}let o=l(t,"input");o.type="text",o.onkeydown=a=>{a.key==="Enter"&&(a.preventDefault(),this.check())},this.input.push(o),l(t,"br")}let n=l(t,"button",{content:"solve!"});n.onclick=()=>this.check()}showStatus(){if(this.view.stat&&this.status.attempts){let t="in "+this.status.attempts+(this.status.attempts===1?" try":" tries"),e=this.status.solved?"&check; "+this.status.steps+" steps/"+this.status.weight+" terms ":this.status.total+" total steps ";this.view.stat.innerHTML=e+" "+t}}showResult(t){if(!this.view.display)return;this.view.display.innerHTML="";let e=l(this.view.display,"div");l(e,"span",{content:"Your solution: "+ge(t.expr)+" "}),t.exception&&l(this.view.display,"div",{class:["ski-quest-error"],content:"Execution failed: "+t.exception});for(let s of t.details){let n=l(this.view.display,"div",{class:s.pass?["ski-quest-success"]:["ski-quest-error"]});l(n,"span",{content:s.pass?"&check; ":"&cross; "}),l(n,"span",{content:`${s.start} &rarr; ${s.found} `});let r=l(n,"a",{content:`in ${s.steps} steps`,class:["ski-quest-control"]});l(n,"span",{content:" "});let o=l(n,"a",{content:" (hide)",class:["ski-quest-control"],hidden:!0});s.pass||(l(n,"br"),s.expected!==void 0&&(l(n,"span",{content:"&nbsp;&nbsp;expected: "+s.expected}),l(n,"br")),s.reason&&(l(n,"span",{content:"&nbsp;&nbsp;"+s.reason}),l(n,"br")));let a=l(n,"div",{});r.onclick=()=>{a.innerHTML="",o.hidden=!1,new me({parent:a,engine:this.engine,height:1/0,max:s.steps+2,headless:!0}).start(s.start)},o.onclick=()=>{a.innerHTML="",o.hidden=!0}}}},V=class{constructor(t){this.options=t,this.quests=[],this.solved=new Set,this.view={},this.number=t.number??0,this.engine=t.engine,this.store=t.store,this.onUnlock=t.onUnlock??(()=>{}),this.updateMeta()}updateMeta(t={}){this.options={...this.options,...t},this.id="chapter-"+(t.id??this.number),this.view.frame&&(this.view.frame.id=this.id),this.view.link&&(this.view.link.href="#"+this.id),this.options.name&&this.view.linkText&&(this.view.linkText.innerHTML="Chapter "+this.number+": "+this.options.name)}fetch(){return fetch(this.options.link).then(t=>t.json()).then(t=>{if(Array.isArray(t)&&(t={content:t}),!Array.isArray(t.content))throw new Error("Invalid quest list in "+this.options.link);this.updateMeta(t);let e=0;for(let s of t.content)this.quests.push(new R(s,{chapter:this,number:++e}));return this})}addSolved(t){this.solved.has(t)||(this.solved.add(t),this.showStatus())}getProgress(){return{total:this.quests.length,solved:this.solved.size,complete:this.solved.size===this.quests.length,percentage:Math.round(this.solved.size/this.quests.length*100)}}attach(t,e){return this.view.frame=l(t,"div",{class:["ski-quest-chapter"]}),this.view.frame.id=this.id,e.placeholder&&(this.view.placeholder=l(this.view.frame,"div",{content:e.placeholder})),this}draw(){this.visible=!0,this.view.placeholder?.remove();let t=l(this.view.frame,"h2"),e=l(this.view.frame,"div");l(t,"span",{content:"Chapter "+this.number+": "+this.options.name}),this.view.stat=l(t,"span",{class:["ski-quest-float-right"]}),t.onclick=()=>{Ut(e,this.visible=!this.visible)},this.view.intro=l(e,"div",{content:Ot(this.options.intro),class:["ski-quest-note","ski-quest-chapter-intro"]}),this.view.content=l(e,"div",{class:["ski-quest-chapter-content"]});for(let s of this.quests)s.load(),s.draw(this.view.content);this.showStatus()}showStatus(){if(!this.view.stat)return;let t=this.getProgress();this.view.stat.innerHTML="Progress: "+t.solved+"/"+t.total+" ("+t.percentage+"%)",t.complete&&this.view.stat.classList.add("success"),this.view.progressbar&&(this.view.progressbar.style.paddingRight=t.percentage+"%",this.view.progressbar.style.marginRight=-t.percentage+"%")}addLink(t){let e=l(t,"div",{class:["ski-quest-nav-item"]}),s=l(e,"a",{},n=>{n.style.display="flex"});s.href="#"+this.id,this.view.link=s,this.view.progressbar=l(s,"span",{class:["ski-quest-progressbar"]}),this.view.linkText=l(s,"span",{content:"Chapter "+this.number+"..."})}};function we(i,t,e){let s=l(i,"span",{}),n=l(s,"span",{content:t,class:["ski-quest-hint"]});n.onclick=()=>{n.remove(),l(s,"span",{content:e})}}function Ot(i){return Array.isArray(i)?i.join(" "):""+i}function ge(i){return i instanceof P.classes.Expr?i instanceof P.classes.Alias?i.name+" = "+i.expand():""+i.expand():""+i}function Ut(i,t){t===void 0&&(t=i.hidden),i.hidden=!t}function ve(i){return i.note??(i.impl??i).format({html:!0,lambda:[""," &mapsto; ",""]})}Ht.exports={QuestPage:ct,QuestChapter:V,QuestBox:R}});var ke=b(()=>{var{QuestBox:xe,QuestChapter:ye,QuestPage:be}=Kt();typeof window<"u"&&(window.QuestBox=xe,window.QuestChapter=ye,window.QuestPage=be)});ke();})();
//# sourceMappingURL=ski-quest.min.js.map
