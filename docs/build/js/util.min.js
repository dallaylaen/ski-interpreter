"use strict";(()=>{var c=(s,t)=>()=>(t||s((t={exports:{}}).exports,t),t.exports);var d=c((nt,L)=>{"use strict";function O(...s){let t={};for(let e of s)t[e]=document.getElementById(e);return t}function F(s,t,e={}){let i=document.createElement(t);return e.class&&i.classList.add(...e.class),e.content!==void 0&&(i.innerHTML=""+e.content),e.hidden&&(i.hidden=!0),e.color&&(i.style.color=e.color),s&&s.appendChild(i),i}function m(s,t){t(s);for(let e of s.childNodes)m(e,t)}function J(s){let t=document.createElement("div");if(t.innerHTML=s.replace(/^[^<]*|[^>]*$/gs,""),t.childNodes.length!==1)throw new Error("Custom HTML element must have exactly one root node");let e=t.childNodes[0],i={};return m(e,n=>{let r=n.getAttribute&&n.getAttribute("data-handle");if(r){if(i[r])throw new Error(`Duplicate data-handle attribute: ${r}`);i[r]=n}}),{...i,elem:e}}function z(s){let t=document.getElementById(s);if(!t)throw new Error(`Template not found: ${s}`);return t.innerHTML}function D(s){typeof s!="string"&&(s=""+s);let t={"<":"&lt;",">":"&gt;","&":"&amp;"};return s.replace(/[<>&]/g,e=>t[e])}function P(s){let t={"(":"%28",")":"%29"};return encodeURIComponent(s).replace(/[()]/g,e=>t[e]).replace(/%20/g,"+")}function V(s){return decodeURIComponent((""+s).replace(/\+/g," "))}L.exports={append:F,custom:J,decode:V,encode:P,grabView:O,sanitize:D,tpl:z,traverse:m}});var S=c((rt,b)=>{"use strict";var{append:g}=d(),w=class{constructor(t={}){this.options=t,this.height=t.height??5,this.running=!1,this.delay=t.delay??0,this.maxSteps=t.max??1/0,this.onStart=t.onStart??(()=>{}),this.onStop=t.onStop??(()=>{}),this.onStep=t.onStep??(()=>{}),this.engine=t.engine,this.format=t.format??{html:!0},this.generator=t.generator??(e=>e.walk()),this.set(t.expr),this.view={},this.view.parent=t.parent,this.view.scroll=t.scroll??t.parent,this.view.main=g(t.parent,"ol",{class:["eval-box"]})}set(t){if(typeof t=="string")this.src=t,this.expr=this.engine.parse(t);else if(Array.isArray(t)&&t.length===2)this.src=t[0],this.expr=t[1];else if(!t)this.expr=null,this.src=null;else if(typeof t=="object"&&typeof t.format=="function")this.expr=t,this.src=t.format();else throw new Error("EvalBox.set() expects a string, Expr, or [string, Expr]");return this}start(t){this.running&&this.stop();try{t!==void 0&&this.set(t),this.seq=this.generator(this.expr)}catch(e){return console.error(e),this.stop(e.message)}return this.view.main.innerHTML="",this.onStart(),this.running=!0,this.tick(),this}stop(t){this.running=!1,this.timer&&(clearTimeout(this.timer),this.timer=null),t&&this.print(t,{class:["error"],line:""}),this.onStop()}tick(){if(!this.running)return;let{value:t,done:e}=this.seq.next();if(t&&this.print(t.expr.format(this.format),{line:t.steps}),this.onStep(t,e||t.final),e||t.final)return this.view.last&&this.view.last.classList.add("success"),this.stop();if(t.steps>=this.maxSteps)return this.stop("Max steps reached: "+this.maxSteps);this.timer=setTimeout(()=>this.tick(),this.delay)}remove(){this.view.parent&&(this.view.parent.removeChild(this.view.main),this.view.parent=null)}clear(){this.stop(),this.view.main.innerHTML=""}setHeight(t){this.height=t}print(t,e={}){let i=g(this.view.main,"li",e);if(e.line!==0&&!e.line?i.style["list-style"]="none":(this.view.main.style["padding-left"]=(""+e.line).length+2.5+"ch",i.value=e.line),this.view.last=i,e.raw)i.innerHTML=t;else for(g(i,"span",{class:e.class??["line-text"],color:e.color,content:t});this.view.main.children.length>this.height;)this.view.main.removeChild(this.view.main.firstChild);return this.view.scroll&&(this.view.scroll.scrollTop=i.offsetTop),i}};b.exports={EvalBox:w}});var C=c((ht,A)=>{"use strict";var q="#expr:",{encode:E,decode:T}=d();function W(s,t){return q+E(t)+"?"+s.declare().map(e=>e.split("=").map(i=>E(i)).join("=")).join(";")}function _(s){let t=s.match(new RegExp("^"+q+"([^?]+)\\??(.*)$"));if(!t)return null;let e=T(t[1]),i=t[2]?t[2].split(";").map(n=>T(n)):[];return{expr:e,decls:i}}function G(s){let t=new URLSearchParams(s);if(t.has("code")||t.has("terms")){let e=t.get("code")??"",i=t.get("terms").split(",");console.log("Migrating old-style link to new-style hash, code =",e,"terms =",i);let n=i.map(r=>r.split(":").map(decodeURIComponent).join("=")).join(";");return"#expr:"+encodeURIComponent(e)+"?"+n}}A.exports={permalink:W,readlink:_,readOldLink:G}});var M=c((at,H)=>{var v=class{constructor(t){this.ns=t+":"}save(t,e){window.localStorage.setItem(this.ns+t,JSON.stringify(e))}load(t){return JSON.parse(window.localStorage.getItem(this.ns+t))}scan(){let t=window.localStorage,e=[];for(let i=0;i<t.length;i++){let n=t.key(i);n.startsWith(this.ns)&&e.push(n.substring(this.ns.length))}return e}delete(t){window.localStorage.removeItem(this.ns+t)}};H.exports={Store:v}});var $=c((ot,I)=>{"use strict";var y=class{constructor(t={}){if(this.onchange=[],this.check=t.check??(e=>!0),t.onchange&&this.onchange.push(t.onchange),t.storage){let[e,i]=t.storage;this.save=()=>e.save(i,this.value),this.load=()=>this.set(e.load(i)??t.default,!0)}else this.save=()=>{},this.load=()=>{this.set(t.default)};this.load()}set(t,e=!1){if(!this.check(t))throw new Error("SMCtl: invalid value "+t);for(let i of this.onchange)i(t,this.value);this.value=t,e||this.save(t)}get(){return this.value}addAction(t){this.onchange.push(t)}};I.exports={SMCtl:y}});var j=c((lt,R)=>{"use strict";var{append:o}=d(),u=null,x=class{constructor(t,e={}){this.button=t,t.classList.add("hamburger-button"),this.parent=t.parentElement,this.hidden=!0,this.content=o(this.parent,"ul",{class:e.right?["hamburger","hamburger-right"]:["hamburger"]}),this.button.addEventListener("click",()=>this.toggle())}appendLi(){return o(this.content,"li")}addSeparator(){return this.appendLi().classList.add("hamburger-separator"),this}addLabel(t){let e=this.appendLi();return o(e,"span",{content:t}),this}addLink(t,e,i){i==="_blank"&&(t=t+" &#x1F517;");let n=this.appendLi(),r=o(n,"a",{content:t});return r.href=e,r.target=i,r.onclick=()=>(this.hide(),!0),this}addAction(t,e){let i=this.appendLi(),n=o(i,"a",{content:t});return n.onclick=()=>{e(),this.hide()},this}addChoice(t,e,i){let n=this.appendLi();o(n,"span",{content:t});let r={};for(let h of i){let a=Array.isArray(h)?h[1]:h,f=Array.isArray(h)?h[0]:h,p=o(n,"a",{content:f,class:["hamburger-choice"]});r[a]=p,p.onclick=()=>{e.set(a),this.hide()}}let l=(h,a)=>{a!==void 0&&r[a]&&r[a].classList.remove("hamburger-current"),r[h]&&r[h].classList.add("hamburger-current")};return e.addAction(l),l(e.get(),void 0),this}addFlags(t,e){let i={},n=this.appendLi();o(n,"span",{content:t});for(let[r,l]of e){let h=o(n,"a",{content:r,class:["hamburger-choice"]});h.onclick=()=>{l.set(!l.get()),this.hide()};let a=(f,p)=>{h.classList.toggle("hamburger-current",f)};l.addAction(a),a(l.get())}return this}hide(){return u===this&&(u=null),this.hidden=!0,this.content.style.display="none",!1}show(){return u&&u.hide(),u=this,this.hidden=!1,this.content.style.display="block",!1}toggle(){return this.hidden?this.show():this.hide(),!1}};R.exports={Hamburger:x}});var U=c((ct,N)=>{"use strict";var k=class{constructor(t){this.store=t.store,this.limit=this.store.load("limit")??100,this.head=this.store.load("head")??0,this.tail=this.store.load("tail")??0}push(t){this.store.save("head",this.head+1),this.store.save(`entry-${this.head}`,t),this.head+=1,this.head-this.tail>this.limit&&(this.store.delete(`entry-${this.tail}`),this.tail+=1,this.store.save("tail",this.tail))}list(){let t=[];for(let e=this.tail;e<this.head;e++){let i=this.store.load(`entry-${e}`);i!==null&&t.push(i)}return t}clear(){for(let t=this.tail;t<this.head;t++)this.store.delete(`entry-${t}`);this.head=0,this.tail=0,this.store.save("head",this.head),this.store.save("tail",this.tail)}setlimit(t){for(this.limit=t,this.store.save("limit",t);this.head-this.tail>this.limit;)this.store.delete(`entry-${this.tail}`),this.tail+=1,this.store.save("tail",this.tail)}};N.exports={History:k}});var B=d(),{EvalBox:K}=S(),{permalink:Q,readlink:X,readOldLink:Y}=C(),{Store:Z}=M(),{SMCtl:tt}=$(),{Hamburger:et}=j(),{History:it}=U();window.SMCtl=tt;window.Hamburger=et;window.EvalBox=K;window.Store=Z;window.History=it;window.append=B.append;window.util={...B,permalink:Q,readlink:X,readOldLink:Y};})();
//# sourceMappingURL=util.min.js.map
