"use strict";(()=>{var c=(i,t)=>()=>(t||i((t={exports:{}}).exports,t),t.exports);var d=c((rt,x)=>{"use strict";function O(...i){let t={};for(let e of i){let s=e.replace(/[A-Z]/g,r=>"-"+r.toLowerCase());t[e]=document.getElementById(s)}return t}function F(i,t,e={}){let s=document.createElement(t);return e.class&&s.classList.add(...e.class),e.content!==void 0&&(s.innerHTML=""+e.content),e.hidden&&(s.hidden=!0),e.color&&(s.style.color=e.color),i&&i.appendChild(s),s}function f(i,t){t(i);for(let e of i.childNodes)f(e,t)}function J(i){let t=document.createElement("div");if(t.innerHTML=i.replace(/^[^<]*|[^>]*$/gs,""),t.childNodes.length!==1)throw new Error("Custom HTML element must have exactly one root node");let e=t.childNodes[0],s={};return f(e,r=>{let n=r.getAttribute&&r.getAttribute("data-handle");if(n){if(s[n])throw new Error(`Duplicate data-handle attribute: ${n}`);s[n]=r}}),{...s,elem:e}}function z(i){let t=document.getElementById(i);if(!t)throw new Error(`Template not found: ${i}`);return t.innerHTML}function D(i){typeof i!="string"&&(i=""+i);let t={"<":"&lt;",">":"&gt;","&":"&amp;"};return i.replace(/[<>&]/g,e=>t[e])}function P(i){let t={"(":"%28",")":"%29"};return encodeURIComponent(i).replace(/[()]/g,e=>t[e]).replace(/%20/g,"+")}function V(i){return decodeURIComponent((""+i).replace(/\+/g," "))}x.exports={append:F,custom:J,decode:V,encode:P,grabView:O,sanitize:D,tpl:z,traverse:f}});var S=c((ht,L)=>{"use strict";var{append:p}=d(),m=class{constructor(t={}){this.options=t,this.height=t.height??5,this.running=!1,this.delay=t.delay??0,this.maxSteps=t.max??1/0,this.onStart=t.onStart??(()=>{}),this.onStop=t.onStop??(()=>{}),this.onStep=t.onStep??(()=>{}),this.engine=t.engine,this.format=t.format??{html:!0},this.generator=t.generator??(e=>e.walk()),this.set(t.expr),this.view={},this.view.parent=t.parent,this.view.scroll=t.scroll??t.parent,this.view.main=p(t.parent,"ol",{class:["ski-eval-box"]})}set(t){if(typeof t=="string")this.src=t,this.expr=this.engine.parse(t);else if(Array.isArray(t)&&t.length===2)this.src=t[0],this.expr=t[1];else if(!t)this.expr=null,this.src=null;else if(typeof t=="object"&&typeof t.format=="function")this.expr=t,this.src=t.format();else throw new Error("EvalBox.set() expects a string, Expr, or [string, Expr]");return this}start(t){this.running&&this.stop();try{t!==void 0&&this.set(t),this.seq=this.generator(this.expr)}catch(e){return console.error(e),this.stop(e.message)}return this.view.main.innerHTML="",this.onStart(),this.running=!0,this.tick(),this}stop(t){this.running=!1,this.timer&&(clearTimeout(this.timer),this.timer=null),t&&this.print(t,{class:["ski-eval-error"],line:""}),this.onStop()}resume(){this.running||!this.seq||(this.running=!0,this.onStart(),this.tick())}tick(){if(!this.running)return;let{value:t,done:e}=this.seq.next();if(t&&this.print(t.expr.format(this.format),{line:t.steps}),this.onStep(t,e||t.final),e||t.final)return this.view.last&&this.view.last.classList.add("ski-eval-success"),this.seq=null,this.stop();if(t.steps>=this.maxSteps)return this.stop("Max steps reached: "+this.maxSteps);this.timer=setTimeout(()=>this.tick(),this.delay)}remove(){this.view.parent&&(this.view.parent.removeChild(this.view.main),this.view.parent=null)}clear(){this.stop(),this.view.main.innerHTML=""}setHeight(t){this.height=t}print(t,e={}){let s=p(this.view.main,"li",e);if(e.line!==0&&!e.line?s.style["list-style"]="none":(this.view.main.style["padding-left"]=(""+e.line).length+2.5+"ch",s.value=e.line),this.view.last=s,e.raw)s.innerHTML=t;else for(p(s,"span",{class:e.class??["ski-eval-line"],color:e.color,content:t});this.view.main.children.length>this.height;)this.view.main.removeChild(this.view.main.firstChild);return this.view.scroll&&(this.view.scroll.scrollTop=s.offsetTop),s}};L.exports={EvalBox:m}});var H=c((at,C)=>{"use strict";var A="#expr:",{encode:E,decode:q}=d();function W(i,t){return A+E(t)+"?"+i.declare().map(e=>e.split("=").map(s=>E(s)).join("=")).join(";")}function Z(i){let t=i.match(new RegExp("^"+A+"([^?]+)\\??(.*)$"));if(!t)return null;let e=q(t[1]),s=t[2]?t[2].split(";").map(r=>q(r)):[];return{expr:e,decls:s}}function _(i){let t=new URLSearchParams(i);if(t.has("code")||t.has("terms")){let e=t.get("code")??"",s=t.get("terms").split(",");console.log("Migrating old-style link to new-style hash, code =",e,"terms =",s);let r=s.map(n=>n.split(":").map(decodeURIComponent).join("=")).join(";");return"#expr:"+encodeURIComponent(e)+"?"+r}}C.exports={permalink:W,readlink:Z,readOldLink:_}});var M=c((ot,T)=>{var g=class{constructor(t){this.ns=t+":"}save(t,e){window.localStorage.setItem(this.ns+t,JSON.stringify(e))}load(t){return JSON.parse(window.localStorage.getItem(this.ns+t))}scan(){let t=window.localStorage,e=[];for(let s=0;s<t.length;s++){let r=t.key(s);r.startsWith(this.ns)&&e.push(r.substring(this.ns.length))}return e}delete(t){window.localStorage.removeItem(this.ns+t)}};T.exports={Store:g}});var $=c((lt,I)=>{"use strict";var w=class{constructor(t={}){if(this.onchange=[],this.check=t.check??(e=>!0),t.onchange&&this.onchange.push(t.onchange),t.storage){let[e,s]=t.storage;this.save=()=>e.save(s,this.value),this.load=()=>this.set(e.load(s)??t.default,!0)}else this.save=()=>{},this.load=()=>{this.set(t.default)};this.load()}set(t,e=!1){if(!this.check(t))throw new Error("SMCtl: invalid value "+t);for(let s of this.onchange)s(t,this.value);this.value=t,e||this.save(t)}get(){return this.value}addAction(t){this.onchange.push(t)}};I.exports={SMCtl:w}});var j=c((ct,R)=>{"use strict";var{append:o}=d(),u=null,v=class{constructor(t,e={}){this.button=t,t.classList.add("hamburger-button"),this.parent=t.parentElement,this.hidden=!0,this.content=o(this.parent,"ul",{class:e.right?["hamburger","hamburger-right"]:["hamburger"]}),this.button.addEventListener("click",()=>this.toggle())}appendLi(){return o(this.content,"li")}addSeparator(){return this.appendLi().classList.add("hamburger-separator"),this}addLabel(t){let e=this.appendLi();return o(e,"span",{content:t}),this}addLink(t,e,s){s==="_blank"&&(t=t+" &#x1F517;");let r=this.appendLi(),n=o(r,"a",{content:t});return n.href=e,n.target=s,n.onclick=()=>(this.hide(),!0),this}addAction(t,e){let s=this.appendLi(),r=o(s,"a",{content:t});return r.onclick=()=>{e(),this.hide()},this}addChoice(t,e,s){let r=this.appendLi();o(r,"span",{content:t});let n={};for(let h of s){let l=Array.isArray(h)?h[1]:h,k=Array.isArray(h)?h[0]:h,b=o(r,"a",{content:k,class:["hamburger-choice"]});n[l]=b,b.onclick=()=>{e.set(l),this.hide()}}let a=(h,l)=>{l!==void 0&&n[l]&&n[l].classList.remove("hamburger-current"),n[h]&&n[h].classList.add("hamburger-current")};return e.addAction(a),a(e.get(),void 0),this}addFlags(t,e){let s=this.appendLi();o(s,"span",{content:t});for(let[r,n]of e){let a=o(s,"a",{content:r,class:["hamburger-choice"]});a.onclick=()=>{n.set(!n.get()),this.hide()};let h=(l,k)=>{a.classList.toggle("hamburger-current",l)};n.addAction(h),h(n.get())}return this}hide(){return u===this&&(u=null),this.hidden=!0,this.content.style.display="none",!1}show(){return u&&u.hide(),u=this,this.hidden=!1,this.content.style.display="block",!1}toggle(){return this.hidden?this.show():this.hide(),!1}};R.exports={Hamburger:v}});var U=c((dt,N)=>{"use strict";var y=class{constructor(t){if(!t.store)throw new Error("History requires a Store instance");this.store=t.store,t.limit&&this.setlimit(t.limit),this.current=void 0}push(t){if(t===this.current)return;this.current=t;let e=this.store.load("head")??0;this.store.save("head",++e),this.store.save(`entry-${e-1}`,t),this.trim()}list(t){let e=[],s=this.store.load("head")??0,r=this.store.load("tail")??0;for(let n=r;n<s;n++){let a=this.store.load(`entry-${n}`);a!==null&&(!e.length||a!==e[e.length-1])&&e.push(a)}return t.last!==void 0&&t.last!==e[e.length-1]&&e.push(t.last),e}clear(){let t=this.store.load("head")??0,e=this.store.load("tail")??0;for(let s=e;s<t;s++)this.store.delete(`entry-${s}`);this.store.save("head",0),this.store.save("tail",0)}setlimit(t){if(typeof t!="number"||t<=0)throw new Error("History limit must be a positive number");this.store.save("limit",t),this.trim(t)}trim(t){t===void 0&&(t=this.store.load("limit")??100);let e=this.store.load("head")??0,s=this.store.load("tail")??0;for(;e-s>t;)this.store.delete(`entry-${s}`),this.store.save("tail",++s)}};N.exports={History:y}});var it=c(()=>{var B=d(),{EvalBox:G}=S(),{permalink:K,readlink:Q,readOldLink:X}=H(),{Store:Y}=M(),{SMCtl:tt}=$(),{Hamburger:et}=j(),{History:st}=U();window.SMCtl=tt;window.Hamburger=et;window.EvalBox=G;window.Store=Y;window.History=st;window.append=B.append;window.util={...B,permalink:K,readlink:Q,readOldLink:X}});it();})();
//# sourceMappingURL=util.min.js.map
